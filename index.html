<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Info Cuaca Jabodetabek</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-in-out;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-sky-200 via-white to-sky-100 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-sky-700 text-white py-4 shadow-lg flex justify-between items-center px-6">
    <h1 class="text-2xl font-bold tracking-wide">Info Cuaca Jabodetabek</h1>
    <div id="clock" class="font-mono text-lg animate-pulse"></div>
  </header>

  <main class="flex-1 flex flex-col lg:flex-row">
    <!-- Sidebar region list -->
    <aside class="lg:w-1/4 w-full bg-white border-r border-sky-300 overflow-y-auto shadow-inner" id="regionSidebar">
      <h2 class="text-lg font-semibold p-4 bg-sky-100 text-sky-800 border-b border-sky-300">Daftar Daerah</h2>
      <ul id="regionList" class="space-y-1 pb-4 px-4">
        <!-- List will be injected here -->
      </ul>
    </aside>

    <!-- Weather display -->
    <section class="flex-1 p-6 bg-white" id="weatherSection">
      <div id="loading" class="text-center text-sky-600 animate-pulse">Memuat data cuaca...</div>
      <div id="weatherContent" class="hidden grid gap-6"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-sky-700 text-white text-center py-2 text-sm shadow-md">
    Data cuaca bersumber dari <a href="https://openweathermap.org" class="underline">OpenWeather</a>
  </footer>

<script>
const REGIONS = [
  { name: "Jakarta", lat: -6.2146, lon: 106.8451 },
  { name: "Bogor", lat: -6.5950, lon: 106.8166 },
  { name: "Depok", lat: -6.4025, lon: 106.7942 },
  { name: "Tangerang", lat: -6.1702, lon: 106.6319 },
  { name: "Bekasi", lat: -6.2349, lon: 106.9896 }
];

const API_KEY = '87128f7df57c93e129bd675c4772c1cc';

function updateClock() {
  const now = new Date();
  const jam = now.toLocaleTimeString('id-ID');
  document.getElementById("clock").textContent = jam;
}
setInterval(updateClock, 1000);
updateClock();

function renderSidebar() {
  const list = document.getElementById("regionList");
  REGIONS.forEach((r, idx) => {
    const li = document.createElement("li");
    li.innerHTML = `<button data-idx="${idx}" class="w-full text-left py-2 px-3 rounded-lg bg-sky-50 hover:bg-sky-200 focus:bg-sky-300 shadow">${r.name}</button>`;
    list.appendChild(li);
  });
  list.addEventListener("click", e => {
    if (e.target.dataset.idx !== undefined) {
      const region = REGIONS[e.target.dataset.idx];
      Swal.fire({
        title: 'Mengambil data...',
        text: `Sedang memuat cuaca untuk ${region.name}`,
        timer: 1000,
        showConfirmButton: false,
        didOpen: () => Swal.showLoading()
      });
      getWeatherForRegion(region);
    }
  });
}

async function getWeatherForRegion(region) {
  document.getElementById("loading").classList.remove("hidden");
  document.getElementById("weatherContent").classList.add("hidden");

  try {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${region.lat}&lon=${region.lon}&appid=${API_KEY}&units=metric&lang=id`;
    const res = await fetch(url);
    if (!res.ok) throw new Error("Gagal mengambil data cuaca");
    const data = await res.json();
    renderWeather(data, region.name);
  } catch (err) {
    Swal.fire('Kesalahan', err.message, 'error');
    document.getElementById("loading").textContent = err.message;
  }
}

function renderWeather(data, regionName) {
  const container = document.getElementById("weatherContent");
  container.innerHTML = "";
  const card = document.createElement("article");
  card.className = "p-4 rounded-xl shadow-lg bg-gradient-to-r from-white via-sky-50 to-white border-l-4 border-sky-500 animate-fadeIn";
  const date = new Date();
  const hari = date.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  card.innerHTML = `
    <h3 class="text-xl font-semibold mb-1 text-sky-800">${regionName}</h3>
    <p class="text-sm text-gray-500 mb-2">${hari}</p>
    <p class="text-gray-700 mb-1">${data.weather[0].description}</p>
    <p class="text-gray-700">Suhu: ${data.main.temp}Â°C, Kelembaban: ${data.main.humidity}%</p>
    <p class="text-gray-700">Angin: ${data.wind.speed} m/s</p>
  `;
  container.appendChild(card);
  document.getElementById("loading").classList.add("hidden");
  container.classList.remove("hidden");
}

renderSidebar();
getWeatherForRegion(REGIONS[0]);
setInterval(() => {
  const current = document.querySelector("#regionList button.focus")?.dataset.idx || 0;
  getWeatherForRegion(REGIONS[current]);
}, 600000);
</script>
</body>
</html>